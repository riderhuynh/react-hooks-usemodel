{"version":3,"file":"main.js","sources":["../src/components/context.js","../src/hooks/useData.js","../src/components/subscribe.js","../src/components/provider.js","../src/components/withData.js","../src/utils/eventEmitter.js","../src/model/validationError.js","../src/model/combineValidators.js","../src/model/field.js","../src/model/initFields.js","../src/model/model.js","../src/model/useModel.js"],"sourcesContent":["import { createContext } from 'react'\n\nconst ReactUseModelContext = createContext(null)\n\nexport { ReactUseModelContext }","import _ from 'lodash'\nimport { useContext } from 'react'\nimport { ReactUseModelContext } from '../components/context'\n\nexport default subscribed => {\n  const { dataSetter, data, setData } = useContext(ReactUseModelContext)\n\n  let change = false\n  const subscribedData = _.mapValues(subscribed, (v, k) => {\n    if (data[k] !== undefined || data[k] === v) return data[k]\n    change = true\n    return v\n  })\n\n  if (change) {\n    setData({ ...data, ...subscribedData })\n  }\n\n  return [subscribedData, dataSetter]\n}\n","import React, { useMemo } from 'react'\nimport useData from '../hooks/useData'\n\nexport default subscribed => WrappedComponent => props => {\n  const [data, dataSetter] = useData(subscribed)\n  return useMemo(\n    () => <WrappedComponent data={data} dataSetter={dataSetter} {...props} />,\n    [data]\n  )\n}","import React, { useState } from 'react'\nimport { ReactUseModelContext } from './context'\n\nconst getFilterFunction = filter =>\n  typeof filter === 'function'\n    ? filter\n    : item =>\n        Object.keys(filter).every(\n          k => item[k] !== undefined && filter[k] === item[k]\n        )\n\nexport default ({ data, setData, children }) => {\n  const [, forceUpdate] = useState(data)\n\n  const put = (name, value) => {\n    forceUpdate({ ...data, [name]: value })\n  }\n\n  const dataSetter = {\n    put,\n    add: (name, value) => {\n      const d = data[name]\n\n      if (!Array.isArray(d)) {\n        put(name, value)\n      } else {\n        d.push(value)\n        put(name, d)\n      }\n    },\n    remove: (name, filter, forced = false) => {\n      if (!filter && !forced) {\n        throw new Error(\n          'Filter is required for remove data. Unless you pass force = true'\n        )\n      }\n\n      let d = data[name]\n      if (!Array.isArray(d) || forced) {\n        delete d[name]\n\n        put(name, d)\n      } else {\n        const filterFn = getFilterFunction(filter)\n        d = d.filter(filterFn)\n\n        put(name, d)\n      }\n    },\n    update: (name, filter, value) => {\n      if (!filter) throw new Error('Filter is required for update data')\n\n      let d = data[name]\n\n      if (!Array.isArray(d) || typeof value !== 'object') {\n        put(name, value)\n      } else {\n        const filterFn = getFilterFunction(filter)\n        d = d.filter(filterFn)\n        d.map(item => ({ ...item, ...value }))\n\n        put(name, d)\n      }\n    },\n  }\n  return (\n    <ReactUseModelContext.Provider value={{ data, dataSetter, setData }}>\n      {children}\n    </ReactUseModelContext.Provider>\n  )\n}\n","import React, { useState } from 'react'\nimport DataProvider from './provider'\n\nexport default initialData => App => props => {\n  const [data, setData] = useState(initialData || {})\n  return (\n    <DataProvider data={data} setData={setData}>\n      <App {...props} />\n    </DataProvider>\n  )\n}\n","const hasOwnProperty = (obj, prop) =>\n  Object.prototype.hasOwnProperty.call(obj, prop)\n\nexport default class EventEmitter {\n  constructor() {\n    this._events = {}\n  }\n\n  initEvents(events) {\n    events.forEach(e => {\n      this._events[e] = []\n    })\n  }\n\n  on(event, handler) {\n    if (!hasOwnProperty(this._events, event))\n      throw new Error('Event is not implemented')\n    this._events[event].push(handler)\n  }\n\n  off(event, handler) {\n    if (!hasOwnProperty(this._events, event))\n      throw new Error('Event is not implemented')\n    this._events[event] = this._events[event].filter(h => h !== handler)\n  }\n\n  trigger(event, ...payload) {\n    if (!hasOwnProperty(this._events, event))\n      throw new Error('Event is not implemented')\n    this._events[event].forEach(handler => {\n      if (typeof handler === 'function') handler.call(this, ...payload)\n    })\n  }\n}","class ValidationError extends Error {\n  constructor(message, field, validator) {\n    super(message)\n    this.name = 'ValidationError'\n    this.field = field\n    this.validator = validator\n  }\n}\nexport default ValidationError","import { sprintf } from 'sprintf-js'\nimport ValidationError from './validationError'\n\n/* Model's field's validation utilities */\nfunction createValidator({ test, errorMessage }) {\n  return value => {\n    if (!test(value, this._model))\n      throw new ValidationError(\n        sprintf(errorMessage, { ...this }),\n        this,\n        test\n      )\n    return true\n  }\n}\n\nexport default function combineValidators(validators, value) {\n  const mappedValidators = validators.map(validator =>\n    createValidator.call(this, validator)\n  )\n  try {\n    mappedValidators.forEach(v => v.call(this, value))\n    return true\n  } catch (e) {\n    return e\n  }\n}","import EventEmitter from '../utils/eventEmitter'\nimport combineValidators from './combineValidators'\n\n/**\n * Model's field\n * @property {function[]} _validators List of validation functions\n * @property {ValidationError} error Error throw after recent failed validation. Null if no error\n * @property {bool} validated Whether the field is validated or not, result can be error or success\n * @property {string} name Field name\n * @property {mixed} value Field value, depends on implementation of field input component\n */\nexport default class Field extends EventEmitter {\n  get value() {\n    return this._value || ''\n  }\n\n  set value(value) {\n    this.setValue(value)\n  }\n\n  get isValid() {\n    return !this.error\n  }\n\n  constructor(model, { validators, sideEffects, ...fieldProps }) {\n    super()\n    this.initEvents(['validated', 'change'])\n\n    this.validated = !validators\n\n    Object.assign(this, fieldProps)\n    this._validators = validators\n    this._sideEffects = sideEffects\n    this._model = model\n  }\n\n  /**\n   * Set validation status and return validated result\n   * @param {*} value\n   */\n  validate(value) {\n    const validated = combineValidators.call(\n      this,\n      this._validators,\n      value !== undefined ? value : this.value\n    )\n    this.validated = true\n    if (validated === true) {\n      this.error = null\n    } else {\n      this.error = validated\n    }\n    this.trigger('validated', this.error)\n    return !this.error\n  }\n\n  /**\n   * Set value without validating\n   * @param {*} value\n   */\n  initValue(value) {\n    this.error = null\n    this.validated = !this._validators\n    this._value = value\n  }\n\n  clearValue() {\n    this.initValue()\n  }\n\n  extractFromEvent(e) {\n    const {\n      target: { value },\n    } = e\n    this.setValue(value)\n  }\n\n  /**\n   * Set value after validate, trigger onChange event after field set\n   * @param {*} value\n   */\n  setValue(value, conflictCheck = []) {\n    if (conflictCheck.includes(this.name)) return\n\n    if (this.value === value) return\n    this.initValue(value)\n    this.validate(value)\n\n    conflictCheck.push(this.name)\n\n    if (typeof this._sideEffects === 'function') {\n      this._sideEffects(this._model, this, conflictCheck)\n    }\n    this.trigger('change', this)\n  }\n}\n","import _ from 'lodash'\nimport Field from './field'\n\nfunction createField(model, modelField) {\n  if (!modelField.name) throw new Error('Models name is required')\n  const { type } = modelField\n  const XField = type instanceof Field ? type : Field\n  return new XField(model, modelField)\n}\n\nfunction defineFieldsAsProperties() {\n  Object.defineProperties(\n    this,\n    _.mapValues(this._fields, field => {\n      return {\n        enumerable: true,\n        configurable: true,\n        get() {\n          return field\n        },\n      }\n    })\n  )\n}\n\nexport default function initFields(defaultData) {\n  this._fields = _.mapValues(this._model, (modelField, name) => {\n    const value = _.get(defaultData, name, undefined)\n    const field = createField(this, { ...modelField, name })\n\n    field.on('change', f => {\n      this.trigger('change', this, f)\n    })\n\n    if (value === undefined) return field\n\n    field.initValue(value)\n    return field\n  })\n  defineFieldsAsProperties.call(this)\n}","import _ from 'lodash'\nimport EventEmitter from '../utils/eventEmitter'\nimport initFields from './initFields'\n\nclass Model extends EventEmitter {\n  get data() {\n    return _.mapValues(this._fields, f => f.value)\n  }\n\n  set data(value) {\n    this.setData(value)\n  }\n\n  get isValid() {\n    return Object.keys(this._fields).every(\n      name => this._fields[name].validated && this._fields[name].isValid\n    )\n  }\n\n  get fields() {\n    return this._fields\n  }\n\n  get errors() {\n    if (\n      !Object.keys(this._fields).every(name => this._fields[name].validated)\n    ) {\n      this.validate()\n    }\n    const errors = _.mapValues(\n      _.pickBy(this._fields, field => !!field.error),\n      field => field.error\n    )\n    return Object.keys(errors).length ? errors : null\n  }\n\n  constructor(model, defaultData) {\n    super()\n    this.initEvents(['change'])\n    this._model = model(this)\n    initFields.call(this, defaultData)\n    if (!this._fields) throw new Error('Model is empty')\n  }\n\n  extractFromEvent(e) {\n    const {\n      target: { name },\n    } = e\n    if (!this._fields[name]) return\n    this._fields[name].extractFromEvent(e)\n  }\n\n  setData(data) {\n    if (!data || typeof data !== 'object') return\n    let changed = false\n    Object.keys(data).forEach(name => {\n      const value = data[name]\n      const field = this._fields[name]\n      if (value === undefined || !field || field.value === value) return\n\n      this._fields[name].setValue(value)\n      changed = true\n    })\n    if (changed) this.trigger('change', this)\n  }\n\n  clearData() {\n    let changed = false\n    Object.keys(this._fields).forEach(name => {\n      const field = this._fields[name]\n      if (field.value !== undefined) {\n        this._fields[name].clearValue()\n        changed = true\n      }\n    })\n    if (changed) this.trigger('change', this)\n  }\n\n  validate() {\n    _.mapValues(this._fields, f => f.validate())\n    this.trigger('change', this)\n    return this.isValid\n  }\n}\n\nexport default Model\n","import { useState, useEffect } from 'react'\nimport _ from 'lodash'\nimport Model from './model'\n\nexport default (model, defaultData) => {\n  const _model = new Model(model, defaultData)\n\n  const [formState, setFormState] = useState(_model)\n\n  const deps = _.values(formState.data)\n  useEffect(() => {\n    const change = newModel => {\n      const newFormState = Object.assign(\n        Object.create(Object.getPrototypeOf(newModel)),\n        newModel\n      )\n      setFormState(newFormState)\n    }\n    formState.on('change', change)\n    return () => {\n      formState.off('change', change)\n    }\n  }, deps)\n  return formState\n}"],"names":["ReactUseModelContext","createContext","subscribed","useContext","dataSetter","data","setData","change","subscribedData","_","mapValues","v","k","undefined","WrappedComponent","props","useData","useMemo","getFilterFunction","filter","item","Object","keys","every","children","useState","forceUpdate","put","name","value","add","d","Array","isArray","push","remove","forced","Error","filterFn","update","map","initialData","App","hasOwnProperty","obj","prop","prototype","call","EventEmitter","_events","events","forEach","e","event","handler","h","payload","ValidationError","message","field","validator","createValidator","test","errorMessage","_model","sprintf","combineValidators","validators","mappedValidators","Field","_value","setValue","error","model","sideEffects","fieldProps","initEvents","validated","assign","_validators","_sideEffects","trigger","initValue","target","conflictCheck","includes","validate","createField","modelField","type","XField","defineFieldsAsProperties","defineProperties","_fields","enumerable","configurable","get","initFields","defaultData","on","f","Model","isValid","errors","pickBy","length","extractFromEvent","changed","clearValue","formState","setFormState","deps","values","useEffect","newModel","newFormState","create","getPrototypeOf","off"],"mappings":"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"}SAaOF,SAAP;CAnBF;;;;;;;;"}